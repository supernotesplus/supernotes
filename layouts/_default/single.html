{{ define "main" }}

<article class="post-single">
    <header class="post-header">
        {{ partial "post_meta.html" . }}
        <h1 class="post-title">{{ .Title }}</h1>
        {{ if .Params.tags }}
        <span class="post-tags">
            {{ range .Params.tags }}
            <a href="{{ . | urlize }}/">{{ . }}</a>
            {{ end }}
        </span>
        {{ end }}
    </header>

    <div class="post-content">
        {{- $content := .Content -}}
        {{- $paragraphs := split $content "</p>" -}}
        {{- $ad_injected := false -}}

        {{- range $index, $paragraph := $paragraphs -}}
            {{- . | safeHTML -}}
            {{- if ne $paragraph "" -}}
                </p>
            {{- end -}}

            {{- if and (eq $index 1) (not $ad_injected) -}}
                {{ partial "ad_injection.html" (dict "context" $ "ad_id" "top_banner") }}
                {{- $ad_injected = true -}}
            {{- end -}}
        {{- end -}}

    </div>
</article>

{{ end }}
